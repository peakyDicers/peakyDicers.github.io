<!DOCTYPE html>
<html lang="en">
<title> peakyDicers </title>

<head>
  <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyDXvlHh-ZUsh77fT4IdbVSCv8jL9iwvhSk",
      authDomain: "peaky-website.firebaseapp.com",
      databaseURL: "https://peaky-website.firebaseio.com",
      projectId: "peaky-website",
      storageBucket: "gs://peaky-website.appspot.com/",
      messagingSenderId: "512676933345"
    };
    firebase.initializeApp(config);
  </script>
  <script>
    var userID;
    firebase.auth().signInAnonymously().catch(function (error) {

      // Handle Errors here.
      var errorCode = error.code;
      var errorMessage = error.message;
      // ...
    });

    firebase.auth().onAuthStateChanged(function (user) {
      if (user) {
        userID = user.uid;
        console.log('userID: ', userID)
        loadOnce();
      }
    });

    var database = firebase.database();
    var storage = firebase.storage();
    var ref = storage.ref();
    var msgRef = ref.child('theMessages.txt');


    function sendMsg() {
      var oldMsg = "";
      var msg = document.getElementById("inputField").value;

      var uniqueID = firebase.database().ref('messages').push();
      uniqueID.set(msg);

    }

  </script>
  <script type="text/javascript">
    var host = "peakydicers.com";
    if ((host == window.location.host) && window.location.protocol != "https:")
      window.location.protocol = "https";
  </script>
  <script>
    var theMessages = firebase.database().ref('messages/');

    function loadOnce(){
      theMessages.on('value', function (snapshot) {
      var listNode = document.getElementById("list");
      while (listNode.hasChildNodes()) {
        listNode.removeChild(listNode.lastChild);
      }
      console.log(snapshot.val());
      var result = [];
      for (var key in snapshot.val()) {
        // skip loop if the property is from prototype
        if (!snapshot.val().hasOwnProperty(key)) continue;
        var obj = snapshot.val()[key];
        console.log(obj);
        result.push(obj);
      }
      result.reverse();
      for (var i = 0; i < result.length; i++){
        var node = document.createElement("p");
        var textnode = document.createTextNode(result[i]);
        node.appendChild(textnode);
        document.getElementById("list").appendChild(node);
      }
    });
    }
  </script>
  <style type="text/css">
    body {
      margin: 40px auto;
      max-width: 650px;
      line-height: 1.6;
      font-size: 18px;
      color: #444;
      padding: 0 10px;
      background-color: #EEEEEE
    }

    h1,
    h2,
    h3 {
      line-height: 1.2
    }
  </style>
</head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="canonical" href="https://peakydicers.com" />

<body>
  <h1>Why, hello there. </h1>
  <p>
    My name is Ian and this is my website.
  </p>
  <a href="https://github.com/peakyDicers">github</a>
  <a href="https://twitter.com/peakyDicers">twitter</a>
  <a href="https://www.facebook.com/peakyDicers">facebook</a>
  <a href="http://peakydicers.tumblr.com/">tumblr</a>
  <p> leave a message: </p>
  <input type="text" id="inputField">
  <button onclick="sendMsg()">enter</button>
  <p id="list">ur msgs</p>
</body>

</html>